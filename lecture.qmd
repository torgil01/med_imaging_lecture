---
title: "Working with medical data in python"
author: "Torgil Vangberg"
format: html
---

# Setting up the software environment 
engine: knitr
highlight-style: github
revealjs:
        theme: [white, custom.scss]

## Libraries

In this exercise we will use two extra libraries

-   `nibabel` for reading and writing images
-   `numpy` for math operations
-   `matplotlib` for plotting

## Using virtual environments {.smaller}

*Not neccesary, but good practice:*

-   Install packages in a virtual environment
-   Prevents conflicts with other libraries/code

Here we use python `venv` to set up a virtual environment.

```{bash}
#| eval: false
#| echo: true
mkdir .venv   # create folder where we will store the venv
python -m venv .venv/nii # create venv called "nii" 
source .venv/nii/bin/activate # activate nii environment
```


::: callout-note
Things may be a bit more complicated under windows.
Under windows, it might be best to use `powershell` for these operations. Also, `python` may be called `py` in windows.
:::

## Installing libraries

Check that the `nii` environment is active. You can see that it is active if the promte is changed to `(nii)`.

Now we can install the libraries

```{.bash}
pip install nibabel
pip install numpy
```

These libraries are only be available in the `nii` environment.

# Training data

-   Will use data from the XIX dataset [https://brain-development.org/ixi-dataset](%5Bhttps://brain-development.org/ixi-dataset/%5D)
-   I have processed images from one participant so that several brain regions are labeled.
-   The goal is to extract two *features* from the images.
    -   Volume of the hippocampus
    -   Average proton density of the hippocampus

## Download data
Download the data from: https://drive.google.com/drive/folders/1hCWnJNbRW9OC0CV1fkozqaxrp2IwNod1?usp=drive_link 

Save it in a folder called `data` alongside your code. 

# Loading data in python
We will start by reading the T1 and label image.

First we load the image objects as follows:

```{python}
#| eval: false
#| echo: true

import nibabel as nib
import numpy as np
t1.nii = nib.load("path_to_t1_image")
label.nii = nib.load("path_to_label_image")
```

Note that `nib.load` only returns the header and not the image data. We load the image data using the method `.get_fdata()`.

```{python}
#| eval: false
#| echo: true

t1 = t1.nii.get_fdata()
label = label.nii.get_fdata()
```


## Inspecting the image header
It may be neccesary to get information about the image header.
